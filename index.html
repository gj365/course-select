<!-- index.html -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>选课首页</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h2>选课首页</h2>

  <div id="time-slots" class="time-slots">
    <!-- 动态填充时间段 -->
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://iodijnhbxihastuknqky.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZGlqbmhieGloYXN0dWtucWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4NjgyNTIsImV4cCI6MjA4NTQ0NDI1Mn0.PTG1s0Zv14VX-yfrZNmJqyu-R7wlvJl3_YYcq40g6Y4";
  const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function loadTimeSlots() {
    const { data, error } = await supabaseClient
      .from("enrollments")
      .select("time_slot, date")
      .group("time_slot, date");

    if (error) {
      console.error("获取时间段失败:", error);
      return;
    }

    const timeSlots = [
      { time: "9:00~9:30", date: "2023-02-25" },
      { time: "9:30~10:00", date: "2023-02-25" },
      { time: "10:00~10:30", date: "2023-02-25" },
      // Add more slots as needed
    ];

    const slotsContainer = document.getElementById("time-slots");

    timeSlots.forEach(slot => {
      const existingCount = data.filter(item => item.time_slot === slot.time && item.date === slot.date).length;
      const maxCount = 2;  // Maximum allowed enrollments for each time slot

      const button = document.createElement("button");
      button.textContent = `${slot.date} ${slot.time}`;
      button.disabled = existingCount >= maxCount;
      button.style.backgroundColor = button.disabled ? '#ccc' : '#4CAF50';
      button.onclick = () => window.location.href = `enroll.html?date=${slot.date}&time=${slot.time}`;

      slotsContainer.appendChild(button);
    });
  }

  loadTimeSlots();
</script>

</body>
</html>
